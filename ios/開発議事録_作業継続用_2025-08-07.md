# カロピー開発議事録 - 作業継続用
## 最終更新：2025-08-07

## プロジェクト状態
**カロピー（caropii）** - 栄養管理アプリに筋トレ記録機能を追加中
- 場所：`/Users/natatekoko/新開発ファイル/caropii/ios`
- 言語：SwiftUI（iOS）

## 現在完成している機能

### 1. 筋トレ記録の基本機能 ✅
**3画面構成で動作中：**
1. `WorkoutRecordView.swift` - 今日の記録一覧表示
2. `ExerciseSelectionView.swift` - 種目選択画面
3. `ExerciseDetailView.swift` - セット詳細入力画面

**特徴：**
- 自動保存（保存ボタンなし）
- kg/lbs切り替え可能
- 各セットにメモ欄あり
- 各入力欄に×ボタンでクリア機能

### 2. データ永続保存 ✅
**実装済みファイル：**
- `Models/WorkoutModels.swift` - データ構造定義
- `Services/WorkoutStorageService.swift` - JSON読み書き
- `WorkoutDataManager.swift` - データ管理（更新済み）

**保存仕様：**
- 保存先：`Documents/WorkoutRecords/2024-01-15.json`
- 形式：読みやすいJSON（人間用）
- 各セットの入力時刻も自動記録（timestamp）
- 0時で日付区切り（将来的に変更可能な設計）

**LLM送信用圧縮関数も実装済み：**
```swift
// 通常保存
{"exerciseName": "ベンチプレス", "sets": [...]}
// LLM送信時
"20240115:BP-60x10,60x8,65x6"
```

### 3. カスタム種目管理 ✅
**アクセス方法：**
ホーム → データを管理 → 筋トレ種目の管理

**実装済みファイル：**
- `ExerciseManagementView.swift` - 種目管理画面
- `DataManagementView.swift` - 更新済み（ボタン追加）

**機能：**
- ➕ボタンで新規追加
- タップで名前編集
- 左スワイプで削除
- ドラッグ&ドロップで並び替え（LazyVStack使用）
- UserDefaultsで保存（キー：`customExercises`）

## 未実装の主要機能

### 1. 過去の記録閲覧
- カレンダー表示 or 履歴一覧（未決定）
- `WorkoutStorageService`に月間データ取得メソッドは実装済み

### 2. 設定画面
- 日付区切り時間の変更（現在0時固定）
- `getTodayDate(cutoffHour: 0)`の引数を変更するだけで対応可能

### 3. 統計・グラフ
- トレーニングボリューム推移
- 1RM計算（LLM側で計算する方針）

## 注意事項・既知の問題

### 1. ツールバー実装の撤回
- `開発議事録_ツールバー実装試行.md`に詳細記録
- 複数行でツールバーが競合する問題
- 将来的に親ビューで統一管理する設計が必要

### 2. データ構造の注意点
- `SetRecord`の`timestamp`はOptional（既存データ対応）
- 新規保存時は必ずtimestamp付き

### 3. 他システムとの連携予定
- Apple Watchデータ（睡眠・ワークアウト）
- 食事記録
- AIによる健康分析（4つのデータを統合）

## 次回作業開始時のコマンド

```bash
# 1. プロジェクトディレクトリへ移動
cd /Users/natatekoko/新開発ファイル/caropii/ios

# 2. 最新の状態確認
ls pfcz/

# 3. Xcodeで開く
open pfcz.xcodeproj
```

## 実装優先順位（推奨）
1. **過去の記録閲覧** - 基本的なデータ活用
2. **設定画面** - ユーザビリティ向上
3. **統計機能** - データの価値向上

## コードの場所メモ
- 筋トレ系：`pfcz/Workout*.swift`, `pfcz/Exercise*.swift`
- データ保存：`pfcz/Models/`, `pfcz/Services/`
- UI部品：各Viewファイル内

---
**この議事録を読んで「続きから作業を始めたい」と伝えれば、すぐに開発を再開できます。**