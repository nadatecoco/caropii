# 開発議事録：食事記録UI改善 - Vertical Slice アプローチ

## 日時
2025-08-09

## 背景と目的
カロピー（Caropii）の食事記録画面のUI改善を実施。現状の問題点を解決し、使いやすさを最大化する。

## 現状の問題点
1. **操作の複雑さ**
   - 追加ボタンが複数（バーコード/OCR/食材選択）で迷う
   - 同じ食材を毎回探す必要がある（横スクロール）
   - 記録に4-5タップ必要

2. **単位の不自然さ**
   - 卵を「50g」で入力（何個か分からない）
   - 納豆を「40g」で入力（パック数が不明）

3. **よく使う食材へのアクセス**
   - 毎回全食材から探す必要
   - 朝食の定番も毎回検索

## 議論の経過

### Phase 1: ChatGPTとの初期設計
- 単一追加ボタン案
- Bottom Sheet統合
- インライン数量エディタ
- 問題：発見性、誤操作リスク、複雑性

### Phase 2: 懸念事項の洗い出し
1. **長押しメニューの発見性問題**
   - 解決：初回3回は必ずメニュー表示
   - ボタン下にヒント常時表示

2. **Undoスタック10件の過剰設計**
   - 解決：MVPは1件のみ保持
   - 画面遷移まで有効

3. **インライン編集の排他制御**
   - 解決：別行タップで自動保存
   - 同時に1行のみ展開

4. **お気に入りが増えすぎる問題**
   - 解決：最大6個表示
   - 使用頻度順で自動並び替え

5. **単位問題（卵の個数 vs グラム）**
   - 解決：内部はg統一、UIは自然な単位
   - 卵→個、納豆→パック、肉→g

## 最終仕様 v0.5

### 基本方針
- **使いやすさ最優先**
- 継続率・通知・筋トレ連携は今回スコープ外

### UI設計
1. **追加導線の統一**
   - 「＋追加」ボタン1個のみ
   - タップ：直前と同じ追加
   - 長押し：メニュー（バーコード/OCR/手入力）

2. **お気に入り（上部配置）**
   - 最大6個表示
   - タップで既定量追加
   - 使用頻度で自動並び替え

3. **単位の自然な表示**
   ```
   卵: 1個 [−1個][+1個]
   納豆: 1パック
   鶏胸肉: 100g [−10g][+50g]
   牛乳: 200ml
   ```

4. **インライン編集**
   - 数値タップで編集モード
   - キーボードツールバーに単位別ボタン

5. **Undo機能**
   - 削除後に「取り消す」バナー
   - 画面遷移まで有効

## 実装アプローチ：Vertical Slice

### なぜVertical Sliceか
- **Horizontal（レイヤー別）の問題**
  - データ層全部 → UI層全部 → やっと動く
  - エラー箇所の特定が困難
  
- **Vertical（機能別）の利点**
  - 各スライスで完全に動く機能
  - 15-20分で1機能完成
  - エラー範囲が限定的（10行程度）

### 極小スライス計画

#### Slice 0: Hello World（10分）
- FoodLogScreen作成
- "食事記録"テキスト表示
- 確認：画面表示

#### Slice 1: 固定リスト（15分）
- ハードコード3件表示
- 確認：リスト表示

#### Slice 2: 削除機能（15分）
- スワイプ削除（メモリのみ）
- 確認：削除動作

#### Slice 3: 固定追加（15分）
- 「卵を追加」ボタン
- 確認：追加動作

#### Slice 4: 合計表示（15分）
- カロリー自動計算
- 確認：数値更新

#### Slice 5: 保存機能（20分）
- UserDefaults永続化
- 確認：再起動後データ保持

#### Slice 6: お気に入り3個（20分）
- 上部に固定3個
- 確認：タップ追加

#### Slice 7: 単位変換（20分）
- 卵→個表示
- 確認：正しい単位

#### Slice 8: インライン編集（30分）
- 数値タップで編集
- 確認：値の変更

#### Slice 9: 動的お気に入り（20分）
- 6個まで、頻度順
- 確認：並び替え

#### Slice 10: 統合ボタン（20分）
- 単一「＋」ボタン
- 確認：メニュー動作

## 期待される効果

### Before（現在）
- 朝食記録：6タップ＋暗算
- 卵の入力：グラム計算必要
- よく使う食材：毎回検索

### After（改善後）
- 朝食記録：3タップ
- 卵の入力：「個」で自然
- よく使う食材：上部に常時表示

## リスク管理

1. **発見性**
   - 初回ガイド実装
   - ヒント常時表示

2. **エラー特定**
   - 15分/10行単位の実装
   - 各スライスで動作確認

3. **手戻り**
   - 早期に問題発見
   - 小さい単位で方向転換

## 次のアクション

1. Slice 0-2を実装（30分）
2. 動作確認と評価
3. 問題なければSlice 3-5へ
4. お気に入り機能の評価（Slice 6-7）
5. 全体統合とテスト

## 技術スタック
- SwiftUI（iOS 17+）
- UserDefaults（データ永続化）
- 既存：HealthKit、OCR、バーコード機能を流用

## 成功基準
- 最頻出操作が1-2タップ
- 自然な単位表示
- エラー時の原因特定が15分以内

---
記録者：Claude
承認：実装前レビュー完了