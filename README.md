# 🍽️ caropii

## 📌 このアプリについて

**caropii**は、日々の食事記録を効率的に行い、AIによる栄養分析アドバイスを受けられる健康管理アプリです。

現在の主な機能：
- 食材選択による簡単な食事記録
- PFC（タンパク質・脂質・炭水化物）とカロリーの可視化
- 今日の栄養摂取状況をグラフで表示
- AI（Gemini）による栄養バランス分析とアドバイス

---

## 🧩 現在の技術スタック

| 機能           | 使用技術                  |
|----------------|---------------------------|
| iOSアプリ      | SwiftUI                   |
| グラフ描画     | Swift Charts              |
| データ保存     | UserDefaults（ローカル）   |
| バックエンド   | Ruby on Rails 8.0.2      |
| データベース   | SQLite                    |
| AI分析         | Google Gemini API         |
| デプロイ       | Render                    |

---

## 📱 現在の機能

### ✅ 実装済み
- **食事記録**: 8種類の基本食材から選択して記録
- **栄養可視化**: PFCの横棒グラフ表示
- **今日の合計**: カロリー・栄養素の合計値表示
- **記録削除**: タップで食事記録を削除
- **AI分析**: 今日の食事データをGemini APIで分析してアドバイス取得
- **バックエンド連携**: 食事データの送信とAI分析結果の取得

### 🔄 データの流れ

```
iOSアプリ（SwiftUI）
    ├─ UserDefaults（ローカル保存）
    └─ Rails API 
        ├─ 食事データ送信 → SQLite保存
        └─ AI分析リクエスト → Gemini API → 分析結果返却
```

---

## 🗂️ 現在のデータ構造

### iOS側（UserDefaults）
- **foods**: 固定8食材のマスターデータ
- **food_entries**: 食事記録（日時・栄養素情報付き）

### Rails側（SQLite）
```sql
-- 食材マスター
CREATE TABLE foods (
  name VARCHAR,
  protein DECIMAL,
  fat DECIMAL, 
  carbs DECIMAL,
  calories DECIMAL
);

-- 食事記録
CREATE TABLE food_entries (
  food_name VARCHAR,
  protein DECIMAL,
  fat DECIMAL,
  carbs DECIMAL, 
  calories DECIMAL,
  consumed_at DATETIME
);
```

---

## 📋 基本食材リスト（現在固定）

1. 鶏胸肉(100g) - 108kcal
2. 白米(150g) - 252kcal  
3. 卵(1個) - 76kcal
4. アボカド(1/2個) - 160kcal
5. バナナ(1本) - 86kcal
6. サーモン(100g) - 208kcal
7. ブロッコリー(100g) - 25kcal
8. オートミール(30g) - 114kcal

---

## 🔮 今後の改善構想

### 🎯 優先度高：次期実装予定

#### 🎙️ 音声プロンプト入力システム
- **自然言語での食事記録**: 「今日は鮭おにぎり2個とサラダチキン食べました」
- **LLMによる食材識別・抽出**: 音声/テキスト → 構造化データ変換
- **2つの入力方式併存**: タップ選択 + 音声プロンプト

#### 🤖 未知食材AI栄養価算出機能
- **段階的確認フロー**:
  1. 未知食材をGemini APIで栄養価算出
  2. ユーザーに推定結果を確認依頼
  3. 承認後に記録 + オプションでDB保存
- **動的な食材DB拡張**: 使用頻度に応じて食材マスタを自動充実

#### 🍎 Apple Watch健康データ統合
- **睡眠データ自動取得**: HealthKitから睡眠時間・質を取得
- **ワークアウトデータ連携**: 心拍数・消費カロリー・運動時間
- **3軸統合AI分析**: 睡眠 + 運動 + 食事データでの総合健康アドバイス

### 🚧 中期実装予定
- [ ] 過去データの表示・カレンダー機能
- [ ] より詳細な栄養素表示（ビタミン・ミネラル等）
- [ ] 食事記録の写真撮影機能
- [ ] 週間・月間の傾向分析とグラフ化

### 🌟 長期的な構想
- [ ] ユーザー認証システム
- [ ] RAG機能による過去データを活用したAI分析
- [ ] PostgreSQL + pgvectorへの移行
- [ ] 他のウェアラブルデバイス連携

---

## 🛠 開発環境のセットアップ

### Rails バックエンド
```bash
cd backend
bundle install
rails db:create db:migrate
rails server  # http://localhost:3000 で起動
```

### iOS アプリ  
```bash
cd ios
open pfcz.xcodeproj  # Xcodeで開く
```

---

## 📊 アプリの使い方

1. **食事記録**: ホーム画面で食材をタップして記録
2. **グラフ確認**: PFCの摂取バランスを横棒グラフで確認
3. **AI分析**: バックエンド経由でGeminiからの栄養アドバイスを取得
4. **記録削除**: 記録した食事をタップして削除

