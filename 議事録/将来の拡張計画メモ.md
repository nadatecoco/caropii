# 🚀 caropii 将来の拡張計画メモ

## 📅 最終更新日
2025年8月9日（UI改善・アニメーション追加）

## 🆕 最新の実装状況（2025年7月28日）

### ✅ 完成済み機能
- **HealthAnalyzer統合システム**: nutrition + sleep分析対応
- **睡眠データ分析機能**: Apple Watch連携
- **コスト最適化設計**: ヘルスケア同期方式採用
- **Apple Watchデータ取得**: HealthKit経由
- **プロンプト統合**: 食事・睡眠で共通構造

## 🎯 忘れてはいけない重要な将来実装

### 🧬 **栄養素の大幅拡張**

#### 現在の栄養素（4項目）
- カロリー、タンパク質、脂質、炭水化物

#### 将来の完全版（24項目）
```
基本4項目: カロリー, タンパク質, 脂質, 炭水化物

ビタミン13種:
- A, B1, B2, B6, B12, C, D, E, K
- ナイアシン, 葉酸, パントテン酸, ビオチン

ミネラル7種:
- ナトリウム, カリウム, カルシウム, マグネシウム
- 鉄, 亜鉛, 食物繊維
```

### 📊 **データ量の爆発的増加**
```
現在: 1000食材 × 15文字 = 15,000トークン
完全版: 1000食材 × 85文字 = 85,000トークン
コスト増加: 約5.7倍（200円/回）
```

### 🔍 **必須の技術対応**

#### ベクトル検索システムの導入
```
目的: 1000食材から関連20食材のみを抽出
効果: 95%のトークン削減
実装: pgvector等のベクトルDB使用
```

#### 段階的分析レベル
```
基本分析: 4項目のみ（軽量・高速）
詳細分析: 24項目全て（重量・高精度）
```

## ⚠️ **実装時の注意事項**

### データベース設計
- 栄養素カラムの拡張を見越した設計
- 段階的追加が可能な構造
- **新方式**: ヘルスケア同期でDB容量問題解決済み

### プロンプト設計
- ✅ **完了**: HealthAnalyzerで統合済み
- 現在は4項目前提で最適化
- 将来の24項目対応を考慮した拡張性

### コスト管理
- ✅ **大幅改善**: DB保存→削除サイクルでDB代ほぼ無料化
- ベクトル検索なしでは運用不可能（変わらず）
- ユーザー選択制（基本 vs 詳細）の検討

### 新たな課題
- **運動データ分析の追加**: 2025年秋頃予定
- **総合健康分析機能**: 食事+睡眠+運動の統合分析
- **分析後自動削除機能**: 実装必須

## 🎨 **UIアニメーション改善（2025年8月9日追加）**

### スタック表現アニメーション
- **概要**: 同じ食材が複数ある時、カードが重なって見える
- **実装イメージ**:
  ```
  卵5個の表示：
  [卵][卵][卵][卵][卵] ← 微妙にずれて重なる（3D的な奥行き感）
  
  左スワイプで減らす：
  最上段の[卵] → ピューっと右に飛んでいく
  下から[卵]が上がってくる
  ```

### 技術要素
- SwiftUI `matchedGeometryEffect` で滑らかな遷移
- `withAnimation(.spring())` でバウンス効果
- カスタム `Transition` で飛んでいくアニメーション
- `ZStack` と `offset` で重なり表現

### なぜ今やらないか
- 基本機能（インライン編集等）が優先
- アニメーション調整は時間がかかる（沼になりやすい）
- 機能完成後のポリッシュフェーズで実装すべき

### 期待効果
- 視覚的に「個数」が直感的に分かる
- 操作が楽しくなる（継続率向上）
- 高品質なアプリ感

## 🎖️ **就活でのアピールポイント**
- スケーラビリティを考慮した設計
- コスト最適化戦略
- 段階的実装による実用性確保

---

**重要度: 🔥最高**  
**実装優先度: 現在は保留、基本機能完成後に着手**  
**技術的依存: ベクトル検索システムが前提**

---
記録者: natatekoko + Claude Code