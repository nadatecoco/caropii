# 議事録：レシート→在庫→料理バッチ構想
日時：2025-08-14  
参加者：natatekoko, Claude

## 📌 概要
食事記録の新しいUXフロー：**レシート撮影→在庫管理→料理バッチ作成→小分け消費**という一気通貫システムの設計

## 🎯 解決したい問題
1. **検索の手間** - 毎回食材を検索して探すのが面倒
2. **作り置き対応** - 5人前作って5回に分けて食べる現実に対応できない
3. **調味料の記録** - 塩・胡椒など少量の調味料を毎回入力するのが非現実的
4. **認知負荷** - 「何を買ったか」「何があるか」を思い出すストレス

## 💡 提案されたソリューション

### 基本フロー
```
1. 買い物 → レシート撮影 → OCRで商品認識 → 在庫（冷蔵庫）に自動登録
2. 料理作成 → 在庫から材料選択 → 調味料も簡単追加 → 「カレー1000g」として保存
3. 食事記録 → 「カレー200g食べた」→ 自動で1/5の栄養計算 → 在庫から自動減算
```

### 技術方針
- **OCR**: オンデバイス優先（プライバシー保護）
- **正規化**: 全角/半角、かな/カナ、記号除去
- **辞書**: ユーザー辞書＋ファジーマッチング
- **LLM**: 低信頼度の行のみ将来対応（Pro機能）

### データモデル（MVP）
```swift
PantryItem {
  id: UUID
  name: String        // 商品名
  unit: String        // 単位（g/ml/個/本）
  qty: Int           // 在庫量
  added_at: Date     // 追加日時（失効計算用）
}

Batch {
  id: UUID
  name: String        // 料理名
  total_g: Int       // 総量
  remaining_g: Int   // 残量
  macros_per_g: {...} // 100gあたりの栄養
}
```

## 🔧 実装方針

### UIの視覚フィードバック（メッセージ禁止）
1. **直近追加3件のピル表示** - 0.3秒ハイライト
2. **タップ時のスケールアニメ** - 0.95→1.0
3. **ハプティクス** - medium強度
4. **チェックマーク** - 追加時に✓を0.3秒表示

### 在庫管理ルール
- **ソフト失効**: デフォルト7日（設定可能1〜365日）
- **失効後**: 灰色表示、ワンタップで削除/延長
- **在庫ズレ対策**: 自動減算＋手動±ボタンで調整

### SearchSheetの拡張
- **[検索]/[冷蔵庫]タブ** - セグメント切り替え
- 冷蔵庫タブは在庫>0のみ表示
- 全画面表示維持（.large）

## ✅ 合意事項
1. レシートは**必須にしない**（バーコード/手動入力も併用）
2. 画像は**即削除**（プライバシー保護）
3. 単位はMVPでは**g/ml/個/本**の4種類
4. 完璧な在庫管理より**使いやすさ優先**

## 📊 期待される効果
- タップ数 **-50%削減**
- 誤記録率 **<5%**
- 「入った感」スコア **≥5/7**

## 🚀 今後のアクション
1. SearchSheetに冷蔵庫タブ追加
2. PantryItemのデータストア実装
3. レシートOCR機能の統合
4. 料理バッチ機能の実装

## 💭 評価
- **全体評価**: 「実生活に沿った、無理のない良い設計」
- **革新性**: 部分的な前例はあるが、この統合的な体験は**業界初**
- **実現可能性**: 技術的に可能、MVPから段階的に拡張可能

---
記録者：Claude